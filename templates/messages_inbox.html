{% extends 'base.html' %}
{% block content %}

<div class="messages-wrapper">
    <h1 class="page-title">ğŸ’¬ Messages</h1>
    <p class="subtitle">Connect with creators for collabs & feedback</p>

    <!-- Search Bar -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search messages..." onkeyup="filterConversations()">
    </div>

    <div class="inbox-list" id="inboxList">
        {% if conversations %}
            {% for conv in conversations %}
                {% set other_user = conv.participant1_id if conv.participant2_id == user_id else conv.participant2_id %}
                {% set last_msg = conv.messages.order_by(Message.timestamp.desc()).first() %}
                {% set unread = conv.messages.filter_by(receiver_id=user_id, read=False).count() %}
                {% set other_user_obj = User.query.get(other_user) %}

                <a href="{{ url_for('chat', conversation_id=conv.id) }}" class="conv-card {% if unread %}unread{% endif %}">
                    <div class="avatar" data-username="{{ other_user_obj.username[0] }}">
                        <span>{{ other_user_obj.username[0] }}</span>
                        <span class="status {% if other_user_obj.is_online %}online{% else %}offline{% endif %}" title="{% if other_user_obj.is_online %}Online{% else %}Offline{% endif %}"></span>
                    </div>
                    <div class="conv-info">
                        <h4>@{{ other_user_obj.username }}</h4>
                        {% if last_msg %}
                            <p>{{ last_msg.content[:60] }}{% if last_msg.content|length > 60 %}...{% endif %}</p>
                            <span class="time">{{ last_msg.timestamp.strftime("%b %d %H:%M") }}</span>
                        {% else %}
                            <p class="no-msg">No messages yet</p>
                        {% endif %}
                    </div>
                    <div class="quick-actions">
                        <button class="action-btn" title="Pin">ğŸ“Œ</button>
                        <button class="action-btn" title="Mute">ğŸ”‡</button>
                        <button class="action-btn" title="Delete">ğŸ—‘ï¸</button>
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <p class="no-messages">âœ¨ Start a conversation to see it here!</p>
        {% endif %}
    </div>
</div>

<script>
function filterConversations() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const cards = document.querySelectorAll(".conv-card");
    cards.forEach(card => {
        const username = card.querySelector("h4").textContent.toLowerCase();
        const message = card.querySelector("p") ? card.querySelector("p").textContent.toLowerCase() : "";
        card.style.display = (username.includes(input) || message.includes(input)) ? "flex" : "none";
    });
}

// Dynamic gradient avatars
document.querySelectorAll('.avatar').forEach(avatar => {
    const colors = [
        'linear-gradient(135deg,#8b5cf6,#22d3ee)',
        'linear-gradient(135deg,#f43f5e,#facc15)',
        'linear-gradient(135deg,#10b981,#3b82f6)',
        'linear-gradient(135deg,#f97316,#ec4899)'
    ];
    const username = avatar.dataset.username.charCodeAt(0);
    avatar.style.background = colors[username % colors.length];
});
</script>

<style>
/* Keep the same styles from your original file */
</style>

{% endblock %}
